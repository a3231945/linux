## 网络故障应用分析
### 一、网络、应用访问缓慢
**1、故障描述**

- 同一VLAN的内网主机之间访问速度缓慢，如互相PING，网上邻居拷贝文件等操作
- 不同VLAN间的主机，访问速度非常缓慢
- 内网主机可以打开网页，但速度非常慢
- 内网主机PING外网域名或DNS服务器时，返回时间较大
- 网络中的各种应用出现时断时续的现象
- 内网主机打开网络中某业务系统时，响应非常缓慢，甚至出现假死状态
	
**2、故障原因分类**
- 网络丢包


	1>网络设备丢包
		故障分析定位方法：在网络中关键设备的两端进行数据包比对，确定该设备是否丢包，从而定位丢包设备
		推荐解决方法：1-更新存在问题的网络设备 2-更新存在问题的网络设备
	
	2>网络堵塞{
		故障分析定位方法：监控关键链路（一般是出口链路）的流量占用情况，查看网络利用率是否过高，每秒数据包是否过多，数据包大小分布是否合理、TCP会话是否正常等各项
		推荐解决方法：1-如果网络堵塞的原因是P2P、病毒、攻击等异常留恋引起的，需要对这些流量进行控制
					  2-如果网络堵塞的原因是网络带宽过小，就应该考虑增加网络带宽
	
	3>MTU设置不当
		故障分析定位方法：采集关键链路数据，查看传输MTU值，再查看网络中关键设备的MTU设置
		推荐解决方法：设定合理的MTU值
	
	4>网络攻击
		故障分析定位方法：监控关键链路，实时发现网络中的异常网络攻击，快速判断网络中是否存在网络异常攻击
		推荐解决方法：根据诊断判断的地址进行排查，封堵
	
	5>负载均衡设置不当
		故障分析定位方法：监控流量通过负载均衡后被分配的情况，确认是否是由于负载均衡设备把数据包分配到错误的链路引起的丢包
		推荐解决方法：合理配置负载均衡策略
			
		
- 网络延迟大


	1>设备延迟
		故障分析定位方法:在网络中关键设备的两端进行数据包对比传输的TCP数据包时延，分析并定位造成延迟的设备。
		推荐解决方法：1-更新引发延迟设备的配置。
					  2-更换引发延迟的网络设备。
	
	2>传输距离延迟
		故障分析定位方法:分析TCP连接中三次握手数据包的时间间隔，查看客户端网络延迟、服务端网络延迟，定位延迟位置。
		推荐解决方法：采用多连接或其他传输层协议，避免网络延迟给TCP传输带来的影响。
	
	3>带宽延迟
		故障分析定位方法:通过分析TCP传输的性能，确定是否存在带宽延迟。通过计算传输的数据量和链路带宽容量，来确定带宽对传输延迟的影响。
		推荐解决方法：增加网络带宽
	
	

- 应用响应慢


	1>TCP连接慢
		故障分析定位方法:通过定义应用直接查看三次握手时延，及客户端、服务器端时延，快速判断TCP连接较慢是发生在客户端还是服务器端。
		推荐解决方法：提升网络传输过程中的传输性能。
	
	2>应用交易处理慢
		故障分析定位方法:通过定义应用直接查看客户端请求时间和服务器响应时间，判断服务器是否存在应用交易处理响应慢的现象。
		推荐解决方法：提高服务器自身硬件性能或优化应用软件性能。
	

- 相关服务响应慢


	1>DNS服务器响应慢
		故障分析定位方法:分析系统捕获DNS通讯数据，分析DNS请求和响应数据包，查看是否存在DNS服务器响应慢的现象。
		推荐解决方法：优化DNS服务器的软硬件配置。
	
	2>数据库服务器响应慢
		故障分析定位方法:捕获数据库通讯数据，分析后台数据库的交易处理请求和响应数据包，查看是否存在数据库交易处理慢的现象。
		推荐解决方法：优化数据库服务器的软硬件配置，优化数据库操作脚本。
	
	3>其他相关服务慢
		故障分析定位方法:捕获应用通讯数据，分析其他相关服务的交易处理请求和响应数据包，查看是否存在交易处理慢的现象。
		推荐解决方法：优化相关服务的软硬件配置。

			
	

### 二、网络、应用无法访问
**1、故障描述**

- 内网主机不能与互联网的任何应用进行通信，如网页、邮件、QQ、FTP等都不能使用。
- 内网主机PING不通DNS服务器，网站域名。
- 内网主机可以上QQ，但打不开网页。
- 内网主机不能访问网络某个特定的应用服务。
	
**2、故障原因分类**

- 网络不可达


	1>物理链路中断
		故障分析定位方法:通过PING定位断点，查看网络设备和物理链路状态，确定是否存在链路中断。
		推荐解决方法：恢复链路的连通性。
	
	2>网络设备宕机
		故障分析定位方法:通过PING定位断点，查看网络设备和物理链路状态，确定是否存在网络设备宕机。
		推荐解决方法：恢复设备正常运行。			
	
	3>严重丢包
		故障分析定位方法:查看链路中TCP数据流是否存在大量重传，如果有，则表明网络中存在大量的丢包情况。通过PING目标主机确认是否存在大量丢包。同时通过分段捕获分析数据包定位丢包设备。
		推荐解决方法：1-如果丢包的原因是P2P、病毒、攻击等异常流量引起的，需对这些流量进行控制。
					 2-如果丢包的原因是某个设备丢包，可考虑对其进行重新配置或更换。			
	
	4>拒绝服务攻击
		故障分析定位方法:判断网络内是否存在拒绝服务攻击，并迅速定位攻击源。
		推荐解决方法：定位攻击源，并对其阻断。			
	
	5>路由不可达
		故障分析定位方法:监控关键链路，分析捕获到的包中是否存在目的不可达的ICMP数据包。通过tracert命令分析不可达的目标地址路由。
		推荐解决方法：更新路由器的路由配置。			
	
	6>策略中断
		故障分析定位方法:，在网络中安全设备的两端进行数据包对比，定位中断点，查看是否是由于防火墙等安全设备的访问控制策略阻断了应用通讯。
		推荐解决方法：修正防火墙等设备上的访问控制策略。			
		
	
- 应用不可达


	1>应用宕机
		故障分析定位方法:统捕获应用通讯数据，自定义应用并对应用进行监控，出现应用宕机时通过应用警报及时预警。
		推荐解决方法：检查服务器端的应用服务状态。。
	
	2>应用拒绝服务
		故障分析定位方法:捕获应用通讯数据，根据科来智能警报查看并定位产生攻击的地址。
		推荐解决方法：到DOS/DDOS等攻击，查找并阻断攻击源。			
	
	3>策略中断
		故障分析定位方法:捕获应用通讯数据，查看是否存在服务器无法接收到客户端连接请求，或出现连接建立被重置的现象。
		推荐解决方法：修正防火墙等设备上的访问控制策略。			
	
		
- 应用无响应


	1>应用故障
		故障分析定位方法:捕获应用通讯数据，可自定义应用并对应用进行长期监控，可以查看应用请求与响应状态，如果出现服务器未响应请求，则服务端可能出现问题。
		推荐解决方法：检查应用的工作状态，查找应用的BUG，或重启应用，重启服务器。
				
		
- 相关响应无响应


	1>DNS服务器无响应
		故障分析定位方法:捕获DNS通讯数据，分析相关的DNS请求和响应数据包，查看是否存在DNS服务未无法正常解析应用地址情况，导致无法连接应用服务器。
		推荐解决方法：检查DNS服务器软硬件情况，恢复DNS服务。
	
	2>数据库服务器无法连接
		故障分析定位方法:捕获数据库通讯数据，分析相关的数据库请求和响应数据包，查看是否存在数据库服务器没有响应，导致无法提供正常交易处理。
		推荐解决方法：检查数据库服务的配置，确保数据库服务正常。			
	
	3>其他相关服务无法连接
		故障分析定位方法:捕获应用通讯数据，分析其他相关服务器的交易处理情况。
		推荐解决方法：优化相关服务的软硬件及策略的设置，确保服务的正常提供。			
			
		
	

